!function(t){"use strict";var e={init:function(){var t;window.self===window.top&&(t=window.addEventListener?"addEventListener":"attachEvent",(0,window[t])("attachEvent"===t?"onmessage":"message",function(t){t.data&&("link"===t.data.message&&e.validateSecret(t.data.secret)&&(window.location=t.data.value),"addItemSuccess"===t.data.message&&e.validateSecret(t.data.secret)&&e.updateCount(t.data.value))},!1))},validateSecret:function(e){return t("iframe.wp-embedded-content").filter(function(a,o){return t(o).data("secret")===e}).length},addItemApi:function(e,a,o){var r="&cart="+JSON.stringify(e),n={type:"GET",url:rstore.urls.cart_api+r,dataType:"jsonp"};a=t.isFunction(a)?a:function(){},o=t.isFunction(o)?o:function(){},t.ajax(n).done(a).fail(o)},addItem:function(t,a,o,r){var n={items:[{id:t,quantity:a>0?a:1}]};e.addItemApi(n,function(t){if(t.error)return e.addItemError(r,t);e.updateCount(t),o?window.location.href=r.find(".rstore-cart").find("a").attr("href"):e.addItemSuccess(r)},function(t){window.console.log(t),r&&e.addItemError(r,t)})},updateCount:function(e){var a;window.self!==window.top?(a=window.location.hash.replace(/.*secret=([\d\w]{10}).*/,"$1"),window.parent.postMessage({message:"addItemSuccess",value:e,secret:a},"*")):(e=void 0!==e.cartCount?e.cartCount:e,e=e?parseInt(e,10):0,t(".rstore-cart-count").text(e),t(".widget.rstore-cart").each(function(){t(this).toggle(!t(this).hasClass("hide-empty")||e>0)}))},addItemButton:function(a){var o=t(this),r=o.closest(".rstore-add-to-cart-form"),n=o.attr("data-id"),s=parseInt(o.attr("data-quantity"),10),d="true"===o.attr("data-redirect");if(a.preventDefault(),o.attr("data-loading"))return!1;o.attr("data-loading","true"),r.find(".rstore-message").empty(),r.find(".rstore-loading").removeClass("rstore-loading-hidden"),e.addItem(n,s,d,r)},addItemSuccess:function(t){t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-cart").removeClass("rstore-cart-hidden")},addItemError:function(t,e){var a,o,r;a=e.error,o=rstore.i18n.error,void 0!==a.message&&(o=a.message),r='<span class="dashicons dashicons-warning rstore-error"></span> '+o,t.find(".rstore-add-to-cart").removeAttr("data-loading"),t.find(".rstore-loading").addClass("rstore-loading-hidden"),t.find(".rstore-message").html(r)},addItemParam:function(){var t=window.location.search.match(/(\?|&)add-to-cart=(.*?)(&|$)/i);null!==t&&rstore.product.id&&(e.addItem(rstore.product.id,parseInt(t[2],10),!1),window.history.replaceState({},"",window.location.href.split("?")[0]))}},a={init:function(){var a,o,r;window.self===window.top&&(a=rstore.pl_id,o=Cookies.get(rstore.cookies.shopperId),r=rstore.urls.gui,t.ajax({url:r,jsonp:"callback",dataType:"jsonp",data:{plid:a,sid:o},success:function(a){"partial"===a.status&&(t(".rstore-welcome-block span.firstname").each(function(){t(this).text(a.name)}),t(".rstore-welcome-block span.lastname").each(function(){t(this).text(a.lastname)}),t(".rstore-welcome-block span.shopper-id").each(function(){t(this).text(a.shopperid)}),t(".rstore-welcome-block").each(function(){t(this).show()}),t(".rstore-login-block").each(function(){t(this).hide()})),t(".rstore-support-block").each(function(){t(".rstore-support-block").html('<a href="tel:'+a.supportphone.number+'" class="support-link" ><span class="number">'+a.supportphone.number+"</span></a>")}),e.updateCount(a.carttotal)}}))}},o={init:function(){t(".rstore-domain-popup").length&&(t("body").append(t("<div></div>").attr("id","rstore-popResults").addClass("")),t("body").append(t("<div></div>").attr("id","rstore-blackout").addClass("")),t("#rstore-popResults").append(t("<div></div>").attr("id","rstore-closePop").addClass("").html("X")),t(".rstore-domain-search").on("click",".rstore-domain-search-button",o.showModal),t("body").on("click","#rstore-closePop, #rstore-blackout",function(){t("#rstore-popResults").fadeOut(),t("#rstore-blackout").fadeOut(),t(".rstore-domain-search .result-content").hide(),t(".rstore_domain_placeholder").append(t(".rstore-domain-popup"))}),/[?&]domainToCheck=./.test(location.search)&&o.showModal())},showModal:function(){t("#rstore-blackout").fadeIn(),t("#rstore-popResults").fadeIn(),t(".rstore-domain-search .result-content").fadeIn(),t("#rstore-popResults").append(t(".rstore-domain-popup"))}};t(document).ready(function(t){e.addItemParam(),e.init(),a.init(),o.init(),t(".rstore-add-to-cart").on("click",e.addItemButton)})}(jQuery);